<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DAO Frontend</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.3.0/dist/web3.min.js"></script>
    <script type="text/javascript">
        window.onload = function() {
            if (window.ethereum) {
                window.web3 = new Web3(ethereum);
                try {
                    ethereum.enable();
                } catch (error) {
                    console.error("User denied account access");
                }
            } else if (window.web3) {
                window.web3 = new Web3(web3.currentProvider);
            } else {
                console.error("No web3 provider detected");
            }

            var abi = [
            {
      "anonymous": false,
      "inputs": [
        {
          "indexed": true,
          "internalType": "address",
          "name": "member",
          "type": "address"
        },
        {
          "indexed": false,
          "internalType": "uint256",
          "name": "startTime",
          "type": "uint256"
        }
      ],
      "name": "MemberAdded",
      "type": "event"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": true,
          "internalType": "address",
          "name": "member",
          "type": "address"
        }
      ],
      "name": "MemberRemoved",
      "type": "event"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": false,
          "internalType": "string",
          "name": "description",
          "type": "string"
        }
      ],
      "name": "ProposalCreated",
      "type": "event"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": false,
          "internalType": "uint256",
          "name": "proposalIndex",
          "type": "uint256"
        }
      ],
      "name": "ProposalExecuted",
      "type": "event"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": true,
          "internalType": "address",
          "name": "member",
          "type": "address"
        },
        {
          "indexed": false,
          "internalType": "uint256",
          "name": "proposalIndex",
          "type": "uint256"
        }
      ],
      "name": "Voted",
      "type": "event"
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "",
          "type": "address"
        }
      ],
      "name": "memberInfo",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "startTime",
          "type": "uint256"
        },
        {
          "internalType": "uint256",
          "name": "tokenBalance",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }
      ],
      "name": "members",
      "outputs": [
        {
          "internalType": "address",
          "name": "",
          "type": "address"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }
      ],
      "name": "proposals",
      "outputs": [
        {
          "internalType": "string",
          "name": "description",
          "type": "string"
        },
        {
          "internalType": "uint256",
          "name": "voteCount",
          "type": "uint256"
        },
        {
          "internalType": "bool",
          "name": "executed",
          "type": "bool"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "totalSupply",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "",
          "type": "address"
        },
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }
      ],
      "name": "votes",
      "outputs": [
        {
          "internalType": "bool",
          "name": "",
          "type": "bool"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "_newMember",
          "type": "address"
        }
      ],
      "name": "addMember",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "_member",
          "type": "address"
        }
      ],
      "name": "removeMember",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "string",
          "name": "_description",
          "type": "string"
        }
      ],
      "name": "createProposal",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "uint256",
          "name": "_proposalIndex",
          "type": "uint256"
        }
      ],
      "name": "vote",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "uint256",
          "name": "_proposalIndex",
          "type": "uint256"
        }
      ],
      "name": "executeProposal",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    }            ];

            var contractAddress = '0xA39Dc4b54D02234B17Eda9e51F099918ec1af3b7';
            var contract = new web3.eth.Contract(abi, contractAddress);

            contract.getPastEvents('allEvents', { fromBlock: 0, toBlock: 'latest' })
                .then(function(events) {
                    events.forEach(function(event) {
                        console.log(event);
                        // Display events on the frontend
                    });
                })
                .catch(console.error);

            contract.events.allEvents()
                .on('data', function(event) {
                    console.log(event);
                    // Display event on the frontend
                })
                .on('error', console.error);

            document.getElementById('addMemberButton').addEventListener('click', function() {
                var newMemberAddress = document.getElementById('newMemberAddress').value;
                contract.methods.addMember(newMemberAddress)
                    .send({ from: web3.eth.defaultAccount })
                    .then(function(receipt) {
                        console.log(receipt);
                        // Handle success
                    })
                    .catch(function(error) {
                        console.error(error);
                        // Handle error
                    });
            });

            document.getElementById('removeMemberButton').addEventListener('click', function() {
                var memberAddress = document.getElementById('memberAddress').value;
                contract.methods.removeMember(memberAddress)
                    .send({ from: web3.eth.defaultAccount })
                    .then(function(receipt) {
                        console.log(receipt);
                        // Handle success
                    })
                    .catch(function(error) {
                        console.error(error);
                        // Handle error
                    });
            });

            document.getElementById('createProposalButton').addEventListener('click', function() {
                var description = document.getElementById('proposalDescription').value;
                contract.methods.createProposal(description)
                    .send({ from: web3.eth.defaultAccount })
                    .then(function(receipt) {
                        console.log(receipt);
                        // Handle success
                    })
                    .catch(function(error) {
                        console.error(error);
                        // Handle error
                    });
            });

            document.getElementById('voteButton').addEventListener('click', function() {
                var proposalIndex = document.getElementById('proposalIndex').value;
                contract.methods.vote(proposalIndex)
                    .send({ from: web3.eth.defaultAccount })
                    .then(function(receipt) {
                        console.log(receipt);
                        // Handle success
                    })
                    .catch(function(error) {
                        console.error(error);
                        // Handle error
                    });
            });

            document.getElementById('executeProposalButton').addEventListener('click', function() {
                var proposalIndex = document.getElementById('executeProposalIndex').value;
                contract.methods.executeProposal(proposalIndex)
                    .send({ from: web3.eth.defaultAccount })
                    .then(function(receipt) {
                        console.log(receipt);
                        // Handle success
                    })
                    .catch(function(error) {
                        console.error(error);
                        // Handle error
                    });
            });
        }
    </script>
</head>
<body>
    <h1>DAO Frontend</h1>

    <!-- Add Member Section -->
    <h2>Add Member</h2>
    <label for="newMemberAddress">New Member Address:</label>
    <input type="text" id="newMemberAddress">
    <button id="addMemberButton">Add Member</button>

    <!-- Remove Member Section -->
    <h2>Remove Member</h2>
    <label for="memberAddress">Member Address:</label>
    <input type="text" id="memberAddress">
    <button id="removeMemberButton">Remove Member</button>

    <!-- Create Proposal Section -->
    <h2>Create Proposal</h2>
    <label for="proposalDescription">Proposal Description:</label>
    <input type="text" id="proposalDescription">
    <button id="createProposalButton">Create Proposal</button>

    <!-- Vote Section -->
    <h2>Vote</h2>
    <label for="proposalIndex">Proposal Index:</label>
    <input type="number" id="proposalIndex">
    <button id="voteButton">Vote</button>

    <!-- Execute Proposal Section -->
    <h2>Execute Proposal</h2>
    <label for="executeProposalIndex">Proposal Index:</label>
    <input type="number" id="executeProposalIndex">
    <button id="executeProposalButton">Execute Proposal</button>

    <!-- Other sections and functionalities can be added similarly -->

</body>
</html>
